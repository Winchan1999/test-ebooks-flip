<!DOCTYPE html>
<html lang="vi">
<head>
<base href="./book/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,user-scalable=no">
<title>Flipbook Smart Viewer</title>
<style>
  html,body{margin:0;padding:0;width:100%;height:100%;background:#0b0f1a;
    display:flex;justify-content:center;align-items:center;overflow:hidden;font-family:system-ui,sans-serif;}

  #flipbook,#scrollbook{width:100%;height:100%;display:none;background:#000;}

  #flipbook .page{background:#fff;width:50%;height:100%;box-shadow:inset 0 0 20px rgba(0,0,0,0.3);}
  #flipbook .page img{width:100%;height:100%;object-fit:contain;}

  #scrollbook{overflow-y:auto;display:flex;flex-direction:column;gap:12px;
    padding:env(safe-area-inset-top,10px) 0 env(safe-area-inset-bottom,10px) 0;}
  #scrollbook .page{width:100%;display:flex;justify-content:center;align-items:center;background:#000;}
  #scrollbook img{width:100%;height:auto;max-width:100%;object-fit:contain;}

  .toolbar{position:fixed;bottom:env(safe-area-inset-bottom,8px);left:50%;
    transform:translateX(-50%);display:flex;gap:0.8rem;z-index:999;
    background:rgba(0,0,0,0.45);padding:6px 12px;border-radius:24px;
    backdrop-filter:blur(12px);align-items:center;transition:opacity 0.4s ease;}
  .toolbar.hide{opacity:0;pointer-events:none;}
  .toolbar button{border:none;background:rgba(255,255,255,0.15);color:#fff;
    font-weight:600;padding:8px 12px;border-radius:50%;cursor:pointer;
    font-size:16px;transition:background 0.2s ease;}
  .toolbar button:hover{background:rgba(255,255,255,0.3);}
  .toolbar span{color:#fff;font-size:13px;min-width:70px;text-align:center;}

  @media(min-width:900px){
    #flipbook{display:block;width:90vw;height:85vh;
      box-shadow:0 0 25px rgba(0,0,0,0.6);border-radius:8px;}
  }

  @supports(-webkit-touch-callout:none){
    #scrollbook{height:calc(100svh - env(safe-area-inset-bottom));}
  }
</style>
</head>
<body>
  <div id="flipbook"><div class="page"><img data-src="pages/1.jpg" alt="Trang 1"></div>
<div class="page"><img data-src="pages/2.jpg" alt="Trang 2"></div>
<div class="page"><img data-src="pages/3.jpg" alt="Trang 3"></div>
<div class="page"><img data-src="pages/4.jpg" alt="Trang 4"></div>
<div class="page"><img data-src="pages/5.jpg" alt="Trang 5"></div>
<div class="page"><img data-src="pages/6.jpg" alt="Trang 6"></div>
<div class="page"><img data-src="pages/7.jpg" alt="Trang 7"></div>
<div class="page"><img data-src="pages/8.jpg" alt="Trang 8"></div>
<div class="page"><img data-src="pages/9.jpg" alt="Trang 9"></div>
<div class="page"><img data-src="pages/10.jpg" alt="Trang 10"></div>
<div class="page"><img data-src="pages/11.jpg" alt="Trang 11"></div>
<div class="page"><img data-src="pages/12.jpg" alt="Trang 12"></div>
<div class="page"><img data-src="pages/13.jpg" alt="Trang 13"></div>
<div class="page"><img data-src="pages/14.jpg" alt="Trang 14"></div>
<div class="page"><img data-src="pages/15.jpg" alt="Trang 15"></div>
<div class="page"><img data-src="pages/16.jpg" alt="Trang 16"></div>
<div class="page"><img data-src="pages/17.jpg" alt="Trang 17"></div>
<div class="page"><img data-src="pages/18.jpg" alt="Trang 18"></div>
<div class="page"><img data-src="pages/19.jpg" alt="Trang 19"></div>
<div class="page"><img data-src="pages/20.jpg" alt="Trang 20"></div>
<div class="page"><img data-src="pages/21.jpg" alt="Trang 21"></div>
<div class="page"><img data-src="pages/22.jpg" alt="Trang 22"></div>
<div class="page"><img data-src="pages/23.jpg" alt="Trang 23"></div>
<div class="page"><img data-src="pages/24.jpg" alt="Trang 24"></div>
<div class="page"><img data-src="pages/25.jpg" alt="Trang 25"></div>
<div class="page"><img data-src="pages/26.jpg" alt="Trang 26"></div>
<div class="page"><img data-src="pages/27.jpg" alt="Trang 27"></div>
<div class="page"><img data-src="pages/28.jpg" alt="Trang 28"></div>
</div>
  <div id="scrollbook"><div class="page"><img data-src="pages/1.jpg" alt="Trang 1"></div>
<div class="page"><img data-src="pages/2.jpg" alt="Trang 2"></div>
<div class="page"><img data-src="pages/3.jpg" alt="Trang 3"></div>
<div class="page"><img data-src="pages/4.jpg" alt="Trang 4"></div>
<div class="page"><img data-src="pages/5.jpg" alt="Trang 5"></div>
<div class="page"><img data-src="pages/6.jpg" alt="Trang 6"></div>
<div class="page"><img data-src="pages/7.jpg" alt="Trang 7"></div>
<div class="page"><img data-src="pages/8.jpg" alt="Trang 8"></div>
<div class="page"><img data-src="pages/9.jpg" alt="Trang 9"></div>
<div class="page"><img data-src="pages/10.jpg" alt="Trang 10"></div>
<div class="page"><img data-src="pages/11.jpg" alt="Trang 11"></div>
<div class="page"><img data-src="pages/12.jpg" alt="Trang 12"></div>
<div class="page"><img data-src="pages/13.jpg" alt="Trang 13"></div>
<div class="page"><img data-src="pages/14.jpg" alt="Trang 14"></div>
<div class="page"><img data-src="pages/15.jpg" alt="Trang 15"></div>
<div class="page"><img data-src="pages/16.jpg" alt="Trang 16"></div>
<div class="page"><img data-src="pages/17.jpg" alt="Trang 17"></div>
<div class="page"><img data-src="pages/18.jpg" alt="Trang 18"></div>
<div class="page"><img data-src="pages/19.jpg" alt="Trang 19"></div>
<div class="page"><img data-src="pages/20.jpg" alt="Trang 20"></div>
<div class="page"><img data-src="pages/21.jpg" alt="Trang 21"></div>
<div class="page"><img data-src="pages/22.jpg" alt="Trang 22"></div>
<div class="page"><img data-src="pages/23.jpg" alt="Trang 23"></div>
<div class="page"><img data-src="pages/24.jpg" alt="Trang 24"></div>
<div class="page"><img data-src="pages/25.jpg" alt="Trang 25"></div>
<div class="page"><img data-src="pages/26.jpg" alt="Trang 26"></div>
<div class="page"><img data-src="pages/27.jpg" alt="Trang 27"></div>
<div class="page"><img data-src="pages/28.jpg" alt="Trang 28"></div>
</div>

  <div class="toolbar" id="toolbar">
    <button onclick="flipPrev()">⟵</button>
    <span id="pageLabel">1 / 28</span>
    <button onclick="flipNext()">⟶</button>
    <button onclick="toggleFS()">⛶</button>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>
  <script>
    const total=28;
    let book,startX=0,currentX=0,dragging=false;

    document.addEventListener('DOMContentLoaded',initMode);

    function initMode(){
      const isMobile=window.innerWidth<900;
      if(isMobile){
        document.getElementById('scrollbook').style.display='flex';
        document.getElementById('toolbar').style.display='none';
        initLazyLoad();
      }else{
        document.getElementById('flipbook').style.display='block';
        initFlipbook();
      }
    }

    function initLazyLoad(){
      const imgs=document.querySelectorAll('#scrollbook img[data-src]');
      const obs=new IntersectionObserver((entries,observer)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            const img=e.target;img.src=img.dataset.src;observer.unobserve(img);
          }
        });
      },{threshold:0.2});
      imgs.forEach(img=>obs.observe(img));
    }

    function initFlipbook(){
      book=$('#flipbook');
      book.turn({width:'100%',height:'100%',display:window.innerWidth<900?'single':'double',
        autoCenter:true,acceleration:true,gradients:true,elevation:80,duration:1200});
      updateLabel();
      book.bind('turned',(e,page)=>updateLabel(page));
      window.addEventListener('resize',()=>{
        const mode=window.innerWidth<900?'single':'double';
        book.turn('display',mode);
      });
      setupGestures();autoHideToolbar();
    }

    function updateLabel(p){
      const page=p||book.turn('page');
      document.getElementById('pageLabel').textContent=page+' / '+total;
    }
    function flipPrev(){book.turn('previous');}
    function flipNext(){book.turn('next');}
    function toggleFS(){
      if(!document.fullscreenElement)document.documentElement.requestFullscreen();
      else document.exitFullscreen();
    }

    function setupGestures(){
      const area=document.getElementById('flipbook');
      const start=x=>{startX=x;dragging=true;};
      const move=x=>{if(!dragging)return;currentX=x;
        book.css('transform','translateX('+(currentX-startX)*0.05+'px)');};
      const end=()=>{if(!dragging)return;
        const delta=currentX-startX;dragging=false;
        book.css('transform','translateX(0)');
        if(delta>60)flipPrev();else if(delta<-60)flipNext();};
      area.addEventListener('mousedown',e=>start(e.clientX));
      area.addEventListener('mousemove',e=>move(e.clientX));
      area.addEventListener('mouseup',end);
      area.addEventListener('mouseleave',end);
      area.addEventListener('touchstart',e=>start(e.touches[0].clientX));
      area.addEventListener('touchmove',e=>move(e.touches[0].clientX));
      area.addEventListener('touchend',end);
    }

    function autoHideToolbar(){
      const tb=document.getElementById('toolbar');
      let timer=null;
      const show=()=>{tb.classList.remove('hide');
        clearTimeout(timer);
        timer=setTimeout(()=>tb.classList.add('hide'),2500);};
      document.addEventListener('mousemove',show);
      document.addEventListener('touchstart',show);
      show();
    }
  </script>
</body>
</html>
